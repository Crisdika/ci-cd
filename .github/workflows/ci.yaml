name: Lint (Ruff)

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Instalar depend√™ncias
        run: pip install -r requirements-dev.txt

      - name: Rodar Ruff e exibir resumo
        run: |
          echo "üîç Rodando Ruff..."
          # Executa Ruff e salva a sa√≠da em um arquivo
          ruff check . > ruff_output.txt || true  # Continua mesmo se houver erros

          # Conta o total de ocorr√™ncias por c√≥digo (ex: E501, W292)
          echo ""
          echo "üìä Resumo de erros por tipo:"
          grep -oE '\b[A-Z][0-9]{3}\b' ruff_output.txt | sort | uniq -c | sort -nr || echo "Nenhum erro encontrado."

          # Verifica se houve algum erro (sa√≠da n√£o vazia)
          ruff check .
          if grep -qE '\b[A-Z][0-9]{3}\b' ruff_output.txt; then
            echo ""
            echo "‚ùå Ruff encontrou problemas. Corrija antes de prosseguir."
            exit 1
          else
            echo ""
            echo "‚úÖ C√≥digo limpo ‚Äî sem erros de lint!"
          fi
