name: Lint (Ruff)

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Instalar dependÃªncias
        run: pip install -r requirements-dev.txt

      - name: Rodar Ruff e exibir resumo
        run: |
          echo "ğŸ” Rodando Ruff..."
          # Executa Ruff e salva a saÃ­da em um arquivo
          ruff check . --output-format text > ruff_output.txt || true

          # Conta o total de ocorrÃªncias por cÃ³digo (ex: E501, W292)
          echo ""
          echo "ğŸ“Š Resumo de erros por tipo:"
          grep -oE '\b[A-Z][0-9]{3}\b' ruff_output.txt | sort | uniq -c | sort -nr || echo "Nenhum erro encontrado."

          # Verifica se houve algum erro (saÃ­da nÃ£o vazia)
          if grep -qE '\b[A-Z][0-9]{3}\b' ruff_output.txt; then
            echo ""
            echo "âŒ Ruff encontrou problemas. Corrija antes de prosseguir."
            exit 1
          else
            echo ""
            echo "âœ… CÃ³digo limpo â€” sem erros de lint!"
          fi
