name: Ruff Lint (changed files only)

on:
  pull_request:
    paths:
      - "**/*.py"

jobs:
  ruff:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # necessÃ¡rio para git diff funcionar corretamente

      - name: Install Ruff
        run: pip install ruff

      - name: Identify changed Python files
        id: diff
        run: |
          FILES=$(git diff --name-only origin/${{ github.base_ref }}...HEAD | grep '\.py$' || true)
          echo "files=$FILES" >> $GITHUB_OUTPUT

      - name: Run Ruff on changed files
        if: ${{ steps.diff.outputs.files != '' }}
        run: |
          echo "Linting: ${{ steps.diff.outputs.files }}"
          ruff check ${{ steps.diff.outputs.files }}

      - name: Skip if no Python files changed
        if: ${{ steps.diff.outputs.files == '' }}
        run: echo "No Python changes detected."
